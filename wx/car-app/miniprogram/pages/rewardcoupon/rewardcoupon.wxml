<!-- miniprogram/pages/coupon/coupon.wxml -->
<wxs src="../../utils/filter.wxs" module="formatTime"></wxs>
<mg-tab tabList="{{tabList}}" bind:tabClick="tabClick" tabCurrent="{{tabCurrent}}" fontSize="28rpx"></mg-tab>
<my-nexttab wx:if="{{isTab}}" tabList="{{tabLists}}" bind:tabClick="tabClicks" tabCurrents="{{tabCurrents}}" couponCount="{{couponCount}}"></my-nexttab>
<view wx:for="{{couponData}}" wx:key="index" wx:if="{{isTab}}">
    <view class="couponContent">
        <view class="couponHead">
            <view class="couponTitle">{{item.name}}</view>
            <view class="couponEdit" bindtap="couponEdit" data-id="{{item._id}}">编辑</view>
        </view>
        <view class="couponDetail">{{item.describe}}</view>
        <view class="couponNum">{{item.rule}}</view>
        <view class="couponMsg">
            <view class="couponIntegral">{{item.integral}}</view>
            <view class="couponLastTime">{{formatTime.formatTime(item.validity,'yyyy.mm.dd')}}</view>
        </view>
    </view>
    <view class="couponControl">
        <button class="couponUse" bindtap="couponUse" data-id="{{item._id}}" data-index="{{index}}">{{isStar?'启用':'停用'}}</button>
        <view class="couponDelete" bindtap="couponDelete" data-id="{{item._id}}" data-index="{{index}}">删除</view>
    </view>
</view>
<view class="load" wx:if="{{!history}}">
    <view class="loading" wx:if="{{!noMore}}" bindtap="loadMore">{{isLoading?'加载中...':'点击加载更多'}}</view>
</view>
<view class="rightBox" bindtap="jumpToAddcoupon">添加卡券</view>
<!-- 历史卡券搜索框 -->
<input wx:if="{{history}}" class="historyInput" bindinput="searchCoupon" bindconfirm="confirmCoupon" value="{{searchCoupon}}" placeholder="昵称/手机号/卡券号"></input>
<block wx:if="{{history}}" wx:for="{{oldCardDate}}" wx:key="index">
    <view class="couponContent">
        <view class="couponHead">
            <view class="couponTitle">{{item.name}}</view>
            <view class="couponQuery">已确认</view>
        </view>
        <view class="coupons">
            <view class="couponone">
                <view class="couponName">昵称：{{item.nickName}}</view>
                <view class="couponphone">手机：{{item.tel}}</view>
            </view>
            <view class="coupontwo">
                <view class="couponNumber">卡券号：123456789</view>
                <view class="couponQueryTime">确认时间:  {{formatTime.formatTime(item.usedTime,'yyyy.mm.dd')}}</view>
            </view>
        </view>
    </view>
    <view class="couponControl" style="justify-content: flex-end">
        <view class="couponDelete">删除</view>
    </view>
</block>
<!-- <view class="load" wx:if="{{history}}">
    <view class="loading" wx:if="{{!noMore}}" bindtap="loadMore">{{isLoading?'加载中...':'点击加载更多'}}</view>
</view> -->